# WCH-FHPM: FH-RCC Deep Learning Prediction Model

A specialized deep learning framework utilizing Vision Transformers (ViT) to identify Fumarate Hydratase-deficient Renal Cell Carcinoma (FH-dRCC) from Whole Slide Images (WSI).

## Overview

This project implements a two-stage classification pipeline based on pathological slices and annotations:
1.  **Tissue Screening**: Distinguishes between normal kidney tissue and tumor regions using a binary classifier.
2.  **FH-RCC Diagnosis**: Specifically identifies FH-RCC within the detected tumor regions.

## Key Results

The model's performance and study findings are summarized in the following figures:

### Study Design and Workflow
- **[Figure 1: Study Workflow](Figure%201%20-%20Revised.pdf)**
  *Overview of the data collection, preprocessing, and model architecture used for FH-RCC prediction.*

### Performance Metrics
- **[Figure 2: Training & Validation](Figure%202%20-%20Revised.pdf)**
  *Detailed analysis of the training convergence and validation results.*

### Diagnostic Accuracy
- **[Figure 3: Confusion Maps & ROC](Figure%203.pdf)**
  *Receiver Operating Characteristic (ROC) curves and confusion matrices showcasing the model's sensitivity and specificity.*

### Visualization
- **[Figure 4: Attention Maps](Figure%204%20revised.pdf)**
  *Heatmaps generated by the ViT model highlighting the histological features most indicative of FH-RCC.*

*(Note: Click the links above to open the figure documents)*

## Technical Implementation

### Requirements
- Python 3.8+
- OpenSlide (Windows/Linux)
- CUDA-enabled GPU (recommended)
- Libraries: `torch`, `torchvision`, `transformers`, `opencv-python`, `openslide-python`, `scikit-learn`

### Data Preparation
The project expects the following directory structure:
```
.
├── data/                  # Whole Slide Images (.svs)
│   ├── patient_01.svs
│   └── ...
├── annotations/           # Annotations (.geojson)
│   ├── patient_01.geojson
│   └── ...
└── WCH-FHPMproject.py     # Main project script
```

### Configuration Note
In `WCH-FHPMproject.py`, you must configure the `OPENSLIDE_PATH` variable to match your local OpenSlide binary installation path before running:
```python
OPENSLIDE_PATH = r"Path\to\your\openslide-bin-4.0.0.6-windows-x64\bin"
```

## Usage
The script includes functions for:
1.  **Training**: `train_normal_tumor_model` and `train_rcc_model`
2.  **Inference**: `slide_level_prediction` aggregates patch scores to predict patient diagnosis.

```python
# Run the main script to perform prediction on test data
python WCH-FHPMproject.py
```

